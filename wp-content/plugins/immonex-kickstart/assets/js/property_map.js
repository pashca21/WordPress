"use strict";(self.webpackChunk_immonex_kickstart=self.webpackChunk_immonex_kickstart||[]).push([[304,91],{6130:(t,e,r)=>{r.r(e),r.d(e,{init:()=>$});var n=r(5861),i=r(4687),a=r.n(i),s=r(2934),o=r.n(s),u=r(2861),c=r(296),p=r.n(c),l=function(){var t=this,e=t._self._c;return e("div",{class:t.classes},[e("div",{directives:[{name:"show",rawName:"v-show",value:!t.consentGranted,expression:"!consentGranted"}],staticClass:"inx-property-map__consent"},[e("div",{staticClass:"inx-property-map__privacy-note uk-flex uk-flex-top"},[t._m(0),t._v(" "),e("div",{staticClass:"uk-width-expand",domProps:{innerHTML:t._s(t.privacyNote)}})]),t._v(" "),e("button",{staticClass:"inx-button inx-button--action uk-button uk-button-primary",on:{click:t.grantConsent}},[t._v(t._s(t.showMapButtonText))])]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.consentGranted&&t.popupVisible,expression:"consentGranted && popupVisible"}],ref:"popup",staticClass:"ol-popup"},[e("a",{ref:"popupCloser",staticClass:"ol-popup-closer",on:{click:t.hidePopup}}),t._v(" "),e("div",{ref:"popupContent"})]),t._v(" "),e("div",{ref:"map",class:["inx-property-map__map",{"inx-property-map__map--has-consent":t.consentGranted}]})])};l._withStripped=!0;var h=r(7639),f=r(1090),d=r(7539),m=r(2846),v=r(1280),g=r(1345),y=r(9090),x=r(3223),w=r(188),k=r(7646),b=r(1140),_=r(9742),S=r(5487),C=r(3078),Z=r(9569),P=r(9515),M=r(8641),D=r(4187);class A extends C.Z{constructor(t){super({attributions:t.attributions,wrapX:t.wrapX}),this.resolution=void 0,this.distance=void 0!==t.distance?t.distance:20,this.minDistance=t.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=t.geometryFunction||function(t){const e=t.getGeometry();return(0,P.h)(!e||"Point"===e.getType(),10),e},this.createCustomCluster_=t.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(t.source||null)}clear(t){this.features.length=0,super.clear(t)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(t,e,r){this.source.loadFeatures(t,e,r),e!==this.resolution&&(this.resolution=e,this.refresh())}setDistance(t){this.updateDistance(t,this.minDistance)}setMinDistance(t){this.updateDistance(this.distance,t)}getMinDistance(){return this.minDistance}setSource(t){this.source&&this.source.removeEventListener(S.Z.CHANGE,this.boundRefresh_),this.source=t,t&&t.addEventListener(S.Z.CHANGE,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(t,e){const r=0===t?0:Math.min(e,t)/t,n=t!==this.distance||this.interpolationRatio!==r;this.distance=t,this.minDistance=e,this.interpolationRatio=r,n&&this.refresh()}cluster(){if(void 0===this.resolution||!this.source)return;const t=(0,M.lJ)(),e=this.distance*this.resolution,r=this.source.getFeatures(),n={};for(let i=0,a=r.length;i<a;i++){const a=r[i];if(!((0,D.sq)(a)in n)){const r=this.geometryFunction(a);if(r){const i=r.getCoordinates();(0,M.HK)(i,t),(0,M.f3)(t,e,t);const a=this.source.getFeaturesInExtent(t).filter((function(t){const e=(0,D.sq)(t);return!(e in n)&&(n[e]=!0,!0)}));this.features.push(this.createCluster(a,t))}}}}createCluster(t,e){const r=[0,0];for(let e=t.length-1;e>=0;--e){const n=this.geometryFunction(t[e]);n?(0,Z.IH)(r,n.getCoordinates()):t.splice(e,1)}(0,Z.bA)(r,1/t.length);const n=(0,M.qg)(e),i=this.interpolationRatio,a=new w.Z([r[0]*(1-i)+n[0]*i,r[1]*(1-i)+n[1]*i]);return this.createCustomCluster_?this.createCustomCluster_(a,t):new f.Z({geometry:a,features:t})}}const I=A;var L=r(1466),U=r(1015),z=(r(7178),r(6764));const R={name:"inx-property-open-layers-map",props:{useClustering:{type:Boolean,default:!0},lat:{type:Number,default:49.858784},lng:{type:Number,default:6.785441},zoom:{type:Number,default:12},autoFit:{type:Boolean,default:!0},markerSetId:{type:String,default:""},markerIconUrl:!1,markerIconScale:{type:Number,default:.65},wrapClasses:{type:String,default:""},privacyNote:{type:String,default:""},showMapButtonText:{type:String,default:"Agreed, show maps!"},requireConsent:{type:Boolean,default:!0}},data:function(){return{id:null,overlay:null,consentGranted:!1,popupVisible:!1,map:null,currentZoom:0,vectorSource:null,markerPropertyData:{}}},computed:{classes:function(){var t=this.wrapClasses.length>0?this.wrapClasses.split(" "):[];return t.push("inx-property-map inx-property-map--type--olmap"),t=t.filter((function(t,e,r){return r.indexOf(t)===e})),t.join(" ")},markerSet:function(){var t=[];for(var e in this.inxMaps[this.markerSetId]){var r=this.inxMaps[this.markerSetId][e],n=parseFloat(Array.isArray(r)?r[0]:r.lat),i=parseFloat(Array.isArray(r)?r[1]:r.lng);n&&i&&t.push(this.propertyMarker([i,n],e))}return t}},watch:{markerSet:function(t){this.map&&(this.updateMarkers(t),this.fitMapView(this.map))}},methods:{grantConsent:function(t){var e=this;t&&(t.preventDefault(),this.$cookies.set("inx_consent_use_maps",!0)),this.consentGranted=!0,this.map=this.createMap(),this.$nextTick((function(){e.map.updateSize()}))},isCluster:function(t){return!(!t||void 0===t.get("features"))},sanitizeUrl:function(t){return t.replace("[^-A-Za-z0-9+&@#/%?=~_|!:,.;()]","")},fetchMarkerPropertyData:function(t){var e=this;return(0,n.Z)(a().mark((function r(){var n,i;return a().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!e.markerPropertyData[t]){r.next=2;break}return r.abrupt("return",e.markerPropertyData[t]);case 2:return n=inx_state.core.rest_base_url+"immonex-kickstart/v1/properties/"+t+"/?inx-r-response=json_map_markers&inx-r-lang="+inx_state.core.locale.substring(0,2),r.prev=3,r.next=6,u.Z.get(n);case 6:return i=r.sent,e.markerPropertyData[t]=i.data,r.abrupt("return",e.markerPropertyData[t]);case 11:return r.prev=11,r.t0=r.catch(3),r.abrupt("return",!1);case 14:case"end":return r.stop()}}),r,null,[[3,11]])})))()},showPopup:function(t,e,r){var i=this;return(0,n.Z)(a().mark((function t(){var n,s,o,u,c,p,l,h,f,d;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=i.$refs.popupContent,s=i.map.getView().getResolution(),o=i.map.getView().calculateExtent(),o[2]-o[0],u=o[3]-o[1],(c=[r[0],r[1]])[0]=c[0]+90*s,c[1]=c[1]+.9*u/2,i.map.getView().animate({center:c,duration:800,easing:U.Vv},{center:c,duration:800,easing:U.YQ}),"",p="",l="",t.next=14,i.fetchMarkerPropertyData(e.slice(0,64).join(","));case 14:if(h=t.sent){t.next=17;break}return t.abrupt("return");case 17:f=0;case 18:if(!(f<e.length)){t.next=35;break}if(d=h[e[f]]){t.next=22;break}return t.abrupt("continue",32);case 22:d.url=(0,z.addBacklinkURL)(d.url),l="padding:16px; font-size:85%; line-height:120%; text-align:center",e.length>1&&f<e.length-1&&(l+="; border-bottom:1px solid #e0e0e0"),p+='<div style="'+l+'">',p+='<a href="'+i.sanitizeUrl(d.url)+'">',d.thumbnail_url&&(p+='<img src="'+i.sanitizeUrl(d.thumbnail_url)+'" style="display:inline-block; max-width:50%; margin-bottom:8px">'),p+="<div>"+d.title+"</div>",p+="</a>",d.type&&(p+="<div>"+d.type+"</div>"),p+="</div>";case 32:f++,t.next=18;break;case 35:n.innerHTML='<div style="max-height:14em; overflow:auto">'+p+"</div>",i.overlay.setPosition(r),i.popupVisible=!0;case 38:case"end":return t.stop()}}),t)})))()},hidePopup:function(){if(this.popupVisible)return this.popupVisible=!1,this.overlay.setPosition(void 0),this.$refs.popupCloser.blur(),!1},addPopup:function(t){var e=this.$refs.popup;this.overlay=new x.Z({element:e,positioning:"bottom-center",offset:this.markerIconUrl?[1,-26]:[0,0]}),t.addOverlay(this.overlay)},propertyMarker:function(t,e){var r=new f.Z({geometry:new w.Z((0,k.mi)(t)),name:e});return r.setStyle(new d.ZP({image:new m.Z({anchor:[.5,1],src:this.markerIconUrl,scale:this.markerIconScale})})),r},updateMarkers:function(t){this.hidePopup(),this.vectorSource.clear(),this.vectorSource.addFeatures(t)},fitMapView:function(t){var e=this;t&&this.autoFit&&0!==this.markerSet.length&&this.$nextTick((function(){t.updateSize();var r=e.vectorSource.getExtent();t.getView().fit(r,{size:t.getSize(),padding:[48,32,32,32]})}))},addMarkers:function(t){var e=this;if(this.useClustering){var r=new I({distance:50,source:this.vectorSource}),n={},i=new _.Z({source:r,style:function(t){var r=t.get("features").length,i=n[r];return i||(i=new d.ZP({image:new m.Z({anchor:[.5,1],src:e.markerIconUrl,scale:e.markerIconScale}),text:new v.Z({text:r>1?r.toString():"",offsetY:-11,fill:new g.Z({color:"#fff"})})}),n[r]=i),i}});t.addLayer(i)}else{var a=new _.Z({source:this.vectorSource});t.addLayer(a)}this.fitMapView(t)},addClickEventListener:function(t){var e=this;t.on("singleclick",(function(r){var n=[],i=t.forEachFeatureAtPixel(r.pixel,(function(t){return t}));if(e.isCluster(i))if(i.get("features").length>1&&e.currentZoom<this.getView().getMaxZoom()){var a=new C.Z({features:i.get("features")});e.$nextTick((function(){t.updateSize();var e=a.getExtent();t.getView().fit(e,{size:t.getSize(),padding:[48,32,32,32],duration:500})}))}else i.get("features").forEach((function(t){n.push(t.get("name"))}));else i&&n.push(i.get("name"));n.length>0?e.showPopup(r,n,i.getGeometry().getCoordinates()):e.hidePopup()}))},addZoomChangeEventListener:function(t){var e=this;t.on("moveend",(function(r){var n=t.getView().getZoom();n!==e.currentZoom&&(e.currentZoom=n,e.hidePopup())}))},createMap:function(){var t=this.$refs.map;this.lat||(this.lat=49.858784),this.lng||(this.lng=6.785441);var e=new h.Z({target:t,layers:[new b.Z({source:new L.Z})],view:new y.ZP({center:(0,k.mi)([this.lng,this.lat]),zoom:this.zoom,minZoom:0,maxZoom:18})});return this.addMarkers(e),this.addPopup(e),this.addClickEventListener(e),this.addZoomChangeEventListener(e),e}},mounted:function(){this.vectorSource=new C.Z({features:this.markerSet}),this.requireConsent&&!this.$cookies.get("inx_consent_use_maps")||this.grantConsent(null)}};const V=(0,r(1900).Z)(R,l,[function(){var t=this._self._c;return t("div",{staticClass:"uk-width-auto uk-margin-small-right"},[t("span",{attrs:{"uk-icon":"icon: location; ratio: 2"}})])}],!1,null,"00ccd266",null).exports;var E,F;function T(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return j(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return j(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return s=t.done,t},e:function(t){o=!0,a=t},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}function j(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var G=jQuery;function N(t,e){return(E=E||(0,n.Z)(a().mark((function t(e,r){var n,i,s,o,c;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=!1,n="string"==typeof e?e:G(e.target).data("dynamic-update")){t.next=4;break}return t.abrupt("return");case 4:-1!==["1","all"].indexOf(n.toString().trim().toLowerCase())&&(i=[],G(".inx-property-map-container").each((function(t,e){var r=G(e).attr("id");r&&i.push(r)})),n=i.join(",")),s=T(n.split(",")),t.prev=6,c=a().mark((function t(){var e,n,i,s,c;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=o.value,n=e.trim(),!G("#"+n).length||!G("#"+n).hasClass("inx-property-map-container")){t.next=11;break}return i=inx_state.core.rest_base_url+"immonex-kickstart/v1/properties/",i+="?inx-r-response=json_map_markers&inx-r-lang="+inx_state.core.locale.substring(0,2),r&&("string"==typeof r?i+="&"+r:r.paramsString&&(i+="&"+r.paramsString)),s="inx-property-map",(c=inx_state.renderedInstances[n]||{})&&(s=c.cid||s,i+="&inx-r-cidata="+encodeURIComponent(JSON.stringify(c))),t.next=11,u.Z.get(i).then((function(t){t.data&&(inx_maps[s]=t.data)})).catch((function(t){return t}));case 11:case"end":return t.stop()}}),t)})),s.s();case 9:if((o=s.n()).done){t.next=13;break}return t.delegateYield(c(),"t0",11);case 11:t.next=9;break;case 13:t.next=18;break;case 15:t.prev=15,t.t1=t.catch(6),s.e(t.t1);case 18:return t.prev=18,s.f(),t.finish(18);case 21:case"end":return t.stop()}}),t,null,[[6,15,18,21]])})))).apply(this,arguments)}function $(){return(F=F||(0,n.Z)(a().mark((function t(){var e,r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=new URL(document.location).searchParams,t.next=3,N("all",e.toString());case 3:G("#inx-property-map, .inx-property-map-container").each((function(t,e){var r=G(e).attr("id");inx_state.vue_instances.property_map=new(o())({el:"#"+r,components:{"inx-property-open-layers-map":V}})})),r=600;try{r=inx_state.search.form_debounce_delay?inx_state.search.form_debounce_delay:r}catch(t){}G(".inx-property-search.inx-dynamic-update").on("search:change",p()(N,r));case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}},6764:(t,e,r)=>{r.r(e),r.d(e,{addBacklinkURL:()=>l,getBacklinkURL:()=>p,init:()=>h});var n,i=r(5861),a=r(4687),s=r.n(a);function o(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return u(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return u(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return s=t.done,t},e:function(t){o=!0,a=t},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var c=jQuery;function p(){if(inx_state.search.backlink_url)return inx_state.search.backlink_url;var t,e=new URLSearchParams(window.location.search),r=new URLSearchParams,n=o(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;"inx-r-"!==i[0].substring(0,6)&&r.append(i[0],i[1])}}catch(t){n.e(t)}finally{n.f()}var a=window.location.origin+window.location.pathname;return Array.from(r).length>0&&(a+="?"+r.toString()),a}function l(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e||(e=p());var r=new URL(t);return r.searchParams.has("inx-backlink-url")&&r.searchParams.delete("inx-backlink-url"),r.searchParams.append("inx-backlink-url",encodeURIComponent(e)),r.toString()}function h(){return(n=n||(0,i.Z)(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:c(window).on("resize",(function(){c(".inx-squared-image").each((function(){c(this).height(c(this).width())}))})),window.setTimeout((function(){c(window).trigger("resize")}),0);case 2:case"end":return t.stop()}}),t)})))).apply(this,arguments)}Function.prototype.inxThrottle=function(t){var e,r=0,n=this;function i(){var i=this;function s(t){r=Date.now(),n.apply(i,t)}var o=t-(Date.now()-r);a(),o<0?s(arguments):e=setTimeout(s,o,arguments)}function a(){e&&(clearTimeout(e),e=void 0)}return i.reset=function(){a(),r=0},i}}}]);